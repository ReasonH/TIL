# 연관관계 매핑

테이블 간의 관계를 객체 연관관계로 매핑하는 과정이다.

### JPA가 지원하는 연관관계 매핑

1. ManyToOne
2. OneToMany
3. OneToOne
4. ManyToMany

### @ManyToOne

- 가장 자주 사용되는 사례
- 일반적으로 외래키가 존재하는 테이블

### @OneToMany

- 1이 연관관계의 주인인 경우
- 테이블 일대다 관계는 항상 N쪽에 외래키가 존재
- 객체와 테이블 차이 때문에 반대편 테이블을 조작하는 특이한 구조
- JoinColumn을 사용하지 않는 경우 조인테이블 방식을 사용하게 됨 → JoinColumn 사용 추천

단점

- 엔티티가 관리하는 외래 키가 다른 테이블에 있음 → 연관관계 관리를 위해 해당 테이블에 추가 UPDATE SQL 실행

### @OneToOne

- 양 쪽의 어떤 테이블에 외래키가 들어가도 됨
- **외래 키에 유니크 제약조건** 추가 (일대일이기 때문)

주 테이블에 외래키가 존재하는 경우

- 장: JPA 매핑 편리, 주테이블만 조회해도 대상테이블 데이터 확인 가능
- 단: 값이 없는 경우 외래 키 null 허용

대상 테이블에 외래키가 존재하는 경우

- 장: 주 테이블-대상 테이블 간 일대일 → 일대다 관계 변경 시 테이블 구조 유지
- 단: 프록시 기능 한계, 지연 로딩 설정해도 즉시로딩 됨
  - 주)Member 조회 시, 대상)Locker가 지연로딩 설정 되었다고 가정
  - Member의 locker 필드가 proxy 객체가 될지 null이 될 지 결정이 필요함
  - 이 경우, 어차피 Locker테이블에 대한 쿼리가 실행되어야함
  - 어차피 쿼리가 실행될거면 지연로딩 하는 의미가 없네? → Hibernate에서 즉시로딩함

### @ManyToMany

- 자동으로 연결 테이블을 생성해준다.
- 그러나 연결 테이블을 직접 조작할 수 없어서 실제로는 사용되지 않음
- 조회 시 쿼리도 복잡해짐
- 결론적으로 사용하지 않음

다대다 관계는 중간 테이블을 두는 둥 최대한 N:1을 이용해 풀어낸다.
